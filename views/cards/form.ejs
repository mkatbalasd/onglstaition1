<div class="card card-form">
<form method="POST" action="<%= card ? '/nagl/cards/' + card.ID : '/nagl/cards' %>">
  <h5 class="mb-3">معلومات البطاقة</h5>
  <div class="mb-3">
    <label class="form-label">تاريخ الإصدار</label>
    <input type="text" name="IssueDate" class="form-control hijri-date" value="<%= card ? card.IssueDate : '' %>">
  </div>
  <div class="mb-3">
    <label class="form-label">تاريخ الانتهاء</label>
    <input type="text" name="ExpirationDate" class="form-control hijri-date" value="<%= card ? card.ExpirationDate : '' %>">
  </div>
  <div class="mb-3">
    <label class="form-label">تاريخ التجديد</label>
    <input type="text" name="RenewalDate" class="form-control hijri-date" value="<%= card ? card.RenewalDate || '' : '' %>">
  </div>

  <div class="mb-3">
    <label class="form-label">المنشأة</label>
    <div class="input-group">
      <select name="FacilityID" class="custom-select select2" required <%= lockFacility ? 'disabled' : '' %>>
        <% facilities.forEach(f => { %>
          <option value="<%= f.FacilityID %>" <%= (card && card.FacilityID === f.FacilityID) || (facility && facility.FacilityID === f.FacilityID) ? 'selected' : '' %>><%= f.Name %> - <%= f.IdentityNumber %> - <%= f.LicenseType || '' %></option>
        <% }) %>
      </select>
      <% if (!lockFacility) { %>
      <a href="/nagl/facilities/new" target="_blank" id="addFacilityBtn" class="btn btn-outline-secondary btn-icon"><i class="bi bi-plus"></i></a>
      <% } %>
      <% if (lockFacility) { %><input type="hidden" name="FacilityID" value="<%= facility.FacilityID %>"><% } %>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">المركبة</label>
    <div class="input-group">
      <select name="VehicleID" class="custom-select select2" required <%= lockVehicle ? 'disabled' : '' %>>
        <% vehicles.forEach(v => { %>
          <option value="<%= v.ID %>" <%= (card && card.VehicleID === v.ID) || (vehicle && vehicle.ID === v.ID) ? 'selected' : '' %>><%= v.PlateNumber || v.SerialNumber %></option>
        <% }) %>
      </select>
      <% if (!lockVehicle) { %>
      <a href="/nagl/vehicles/new" target="_blank" id="addVehicleBtn" class="btn btn-outline-secondary btn-icon"><i class="bi bi-plus"></i></a>
      <% } %>
      <% if (lockVehicle) { %><input type="hidden" name="VehicleID" value="<%= vehicle.ID %>"><% } %>
      <input type="hidden" id="vehicleHidden" value="<%= card ? card.VehicleID : (vehicle ? vehicle.ID : '') %>">
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">المورد</label>
    <div class="input-group">
      <select name="Supplier" class="custom-select select2">
        <% suppliers.forEach(s => { %>
          <option value="<%= s.id %>" <%= card && card.Supplier === s.id ? 'selected' : '' %>><%= s.name %></option>
        <% }) %>
      </select>
      <a href="/nagl/suppliers/new" target="_blank" id="addSupplierBtn" class="btn btn-outline-secondary btn-icon"><i class="bi bi-plus"></i></a>
    </div>
  </div>

  <button type="submit" class="btn btn-success">حفظ</button>
</form>
</div>
